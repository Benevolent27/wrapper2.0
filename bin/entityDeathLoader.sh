#!/bin/bash
# This script part will be autogenerated when the wrapper starts.  It loads the appropriate variables for the mod script to use.  This is to allow the script to be "installed" to any folder.

# This script needs to be run like this:
# playerDeathLoader.sh "\PATH\TO\SCRIPT\playerDeath.sh" [PlayerName] [deathType] (killer/Entity Responsible) (Entity Responsible)
# Either the killer or entity responsible may or may not be included in the death event, so this script will determine what information was supposed to be where depending on the deathtype
#
# Example: ./playerDeathLoader.sh ~/scripts/wrapper2.0/mods/eventsEngine/playerDeath.sh 11-22-17 5:05pm Benevolent27 player Benevolent27 DestroyerOfWorlds


if [ "${2}" ]; then
	starMadeDir=~/starmade/StarMade/
	scriptDir=~/scripts/
	wrapperDir="${scriptDir}wrapper2.0/"

	addIniVariable="${wrapperDir}bin/ini/addIniVariable.sh"
	checkIniIfVariableExists="${wrapperDir}bin/ini/checkIniIfVariableExists.sh"
	getIniValue="${wrapperDir}bin/ini/getIniValue.sh"
	getIniVariables="${wrapperDir}bin/ini/getIniVariables.sh"
	renIniVariable="${wrapperDir}bin/ini/renIniVariable.sh"
	rmIniVariable="${wrapperDir}bin/ini/rmIniVariable.sh"
	setIniVariable="${wrapperDir}bin/ini/setIniVariable.sh"

	melvin_chat="${scriptDir}wrapper/melvin_chat.sh"
	melvin_chat_public="${scriptDir}wrapper/melvin_public_chat.sh"
	server_message_to="${scriptDir}server_message_to.sh"

	# Shows as a red popup
	server_error_to="${scriptDir}server_error_to.sh"
	# Shows as a green popup
	server_info_to="${scriptDir}server_info_to.sh"
	# Shows as a blue popup
	server_warning_to="${scriptDir}server_warning_to.sh"

	echo "#####-entityDeathLoader.sh running"
	modsDir="${wrapperDir}mods/"
	scriptCalled="${1}"
	shift
	modFolder="$(echo "${scriptCalled}" | sed -E 's_/[0-9A-Za-z \._-]*$__g')/"
	# echo "ModFolder set: ${modFolder}"
	userFolder="${modFolder}userFiles/"
	# echo "userFolder: ${userFolder}"
	commandsFolder="${modFolder}commands/"
	# echo "commandsFolder: ${commandsFolder}"

	wrapperBinFolder="${wrapperDir}bin/"
	# echo "wrapperBinFolder: ${wrapperBinFolder}"


	binFolder="${modFolder}bin/"
	# echo "binFolder: ${binFolder}"

	echo "###  entityDeathLoader.sh - Loading Variables"
	entityType="$1"
	shift
	entityName="$1"
	echo "entityType: ${entityType} entityName: ${entityName}"
	echo "###"


	function runScript {
		# This runs the script in-line so that it inherits the variables set above
		echo "Running entityDeath script: ${scriptCalled}"
		. "${scriptCalled}" "${@}"
	}

	# There are currently no settings that can be set for an entityDeathLoader script, but this is here anyhow for future reference if needed.
	commandIni="$(echo "${scriptCalled}" | sed 's/\.sh$//g').ini"
	# echo "entityDeathIni: ${commandIni}"

	runScript "$@"
else
	echo 'Usage: entityDeathLoader.sh \"\PATH\TO\SCRIPT\entityDeath.sh\" [entityType] ["Entity Name"]'
fi
